from pathlib import Path
efp_plugin = Path("./..")
sys.path.insert(0, str(efp_plugin.expanduser().resolve()))
import efp_gamess

import mmap
import re

# Get the EFP2/MP2 energy from the GAMESS example output
gamess_log = Path("./gamess_ex.log")
with gamess_log.open('r') as f, mmap.mmap(f.fileno(), 0, access=mmap.ACCESS_READ) as s:
    gamess_mp2 = float(re.search(br'E\(2\)=(?P<emp2>.*)', s).group('emp2'))

memory 1100 mb

molecule {
  C      -0.760348   -0.184626   -0.375944
  C      -0.359139    1.221670   -0.221730
  O      0.105433    0.221711    0.712263
  H      -1.062208    1.936726    0.204119
  H       0.417567    1.639988   -0.860411
  H      -0.232306   -0.767959   -1.131840
  C      -2.126083   -0.688966    0.012252
  H      -2.575921   -0.049412    0.778944
  H      -2.787098   -0.705369   -0.863386
  H      -2.062442   -1.709639    0.407385 
symmetry c1
}

set {
  basis aug-cc-pvdz
  puream true
  gauge velocity
  #omega [355,436,589,633, nm]
  omega [355, nm]
  scf_type pk
  mp2_type conv
}

set efp_gamess {
  print 1
  hdf5_filename "gamess_ex.h5"
}

set cclambda {
 r_convergence 1
}

set ccresponse {
  maxiter 150
  r_convergence 1
}

scf_e, wfn = energy('efp_gamess', return_wfn=True)

ccsd_e = energy('ccsd', ref_wfn=wfn)
compare_values(gamess_mp2, variable('MP2 CORRELATION ENERGY'), 8, 'MP2-EFP PTE correlation energy')

properties('ccsd', properties=['rotation'], ref_wfn=wfn)
